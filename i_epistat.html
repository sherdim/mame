
<!DOCTYPE html>

<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Эпидемиологическая статистика &#8212; Практикум по математическим методам в исследовательской деятельности</title>
    
  <link rel="stylesheet" href="_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/book.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/translations.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Алфавитный указатель" href="genindex.html" />
    <link rel="search" title="Поиск" href="search.html" />
    <link rel="next" title="☑ Динамика заболеваний" href="w_epistat.html" />
    <link rel="prev" title="Скрининговая диагностика" href="i_age_logistic.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  <img src="_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Практикум по математическим методам в исследовательской деятельности</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Искать в этой книге ..." aria-label="Искать в этой книге ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Предисловие
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="pr_intro.html">
   Освоение рабочей среды
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="i_python.html">
     Освоение языка Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_sreda.html">
     Подготовка рабочего места
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_sredaonline.html">
     Онлайн-платформы
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_nb.html">
     Создание нового блокнота
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_nb_cell.html">
     Операции с ячейками
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_nb_str.html">
     Строки в кавычках
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_nb_cycle.html">
     Циклы
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_keyboard.html">
     Управление с клавиатуры
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_types.html">
     Разные типы - разное поведение!
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_task.html">
     Как работать с блокнотами упражнений?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_rename.html">
     Как переименовать блокнот?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_def.html">
     Функция
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_zaim.html">
     Заимствование кода
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_scriptwork.html">
     Выполнение практических работ на скриптовых языках
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_nbtips.html">
     Памятка
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="z_intro.html">
     * * *
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="pr_stohastic.html">
   Стационарные стохастические процессы
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="i_empiric.html">
     Эмпирические распределения значений
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="w_data1.html">
     ✍ Получение набора данных
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_hist.html">
     Построение гистограммы распределения
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_random.html">
     Генератор случайных чисел
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="w_random.html">
     ☑ Генерация случайных выборок
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="pr_eda.html">
   Разведочный анализ
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="i_vector.html">
     Составные типы данных
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_dataset.html">
     Готовые наборы данных
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_pairplot.html">
     Структура данных
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_demographic.html">
     Сведенья о пациентах
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_standart.html">
     Cтандартизация данных
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_turtle.html">
     Работа с таблицами
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="w_turtle.html">
     ☑ Подготовка данных
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="z_eda.html">
     * * *
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="pr_linear.html">
   Линейные модели
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="i_dataset_rt.html">
     Формирование набора данных
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_normality.html">
     Проверка нормальности распределения
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_groupmean.html">
     Групповая статистика
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_combine.html">
     Объединение наборов данных
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_anova.html">
     Вариационный анализ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="w_granada.html">
     🗎 Сравнение выборок
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_logscale.html">
     Логарифмирование
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="w_modeline.html">
     🗎 Сравнение регрессионных моделей
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_retivo.html">
     Подбор параметров распределения
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="pr_plan.html">
   Планирование экспериментов
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="i_power.html">
     Мощность исследования
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_quartile.html">
     Анализ публикационного ландшафта
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="w_artana.html">
     🗎 Анализ научной статьи
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="pr_nonlinear.html">
   Нелинейные модели
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="w_data2.html">
     ✍ Получение набора данных 2
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_exp.html">
     Экспоненциальные рост и угасание
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_season.html">
     Сезонные колебания
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_ecg.html">
     Выделение событий в сигнале
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_wav.html">
     Визуализация аудиозаписи
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_spectral.html">
     Спектральный анализ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="w_spec.html">
     🗎 Спектральный анализ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_perehod.html">
     Переходные процессы
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_prognoz.html">
     Прогнозирование
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_gaupro.html">
     Компоненты нелинейного процесса
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="pr_struct.html">
   Структурные модели
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="i_kiss.html">
     Дистанция между строками
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_seq.html">
     Обнаружение нарушений в структуре
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="w_clu.html">
     🗎 Кластерный анализ
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="pr_matrix.html">
   Двумерные массивы данных
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="i_coordinates.html">
     Координаты
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_matrix.html">
     Операции с матрицами
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_dim.html">
     Увеличение размерности
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_pictu.html">
     Обработка изображений
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="w_pictu.html">
     🗎 Анализ изображения
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 current active collapsible-parent">
  <a class="reference internal" href="pr_proba.html">
   Вероятностные модели
  </a>
  <ul class="current collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="i_sexproba.html">
     Случайность - двигатель прогресса?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_codon.html">
     Частоты кодонов
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="i_age_logistic.html">
     Скрининговая диагностика
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Эпидемиологическая статистика
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="w_epistat.html">
     ☑ Динамика заболеваний
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="pr_qual.html">
   Квалиметрические модели
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="w_qual.html">
     🗎 Оценка качества
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="pedagogic.html">
   Заметки для преподавателей
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="references.html">
   Список литературы
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="annotation.html">
   Аннотация
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Переключить навигацию" aria-controls="site-navigation"
            title="Переключить навигацию" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Загрузите эту страницу"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/i_epistat.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Скачать исходный файл" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Распечатать в PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Полноэкранный режим"
                title="Полноэкранный режим"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/sherdim/mame/gh-pages?urlpath=notebooks/_sources/i_epistat.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Запуск Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Содержание
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id3">
   Подготовка данных про инфекционные заболевания
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id4">
   Анализ пустот
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id5">
   Динамика
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     Сезонная динамика
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id7">
     Годовая динамика
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id8">
     Разложение на компоненты
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id9">
     Фазовые сдвиги
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id10">
     Скачкообразная динамика
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id11">
     Эффекты развития здравоохранения
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id12">
   Примеры решения задач
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id13">
     Задача на прогноз по предыдущим значениям
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id14">
     Задача на линейную экстраполяцию
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id15">
     Задача на лаг в неделях
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id16">
     Задача на выявление корреляций
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="id1">
<h1>Эпидемиологическая статистика<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h1>
<p>Рассмотрим онлайн-приложение <a class="reference external" href="https://epistat.wiv-isp.be">https://epistat.wiv-isp.be</a> .</p>
<p>Изучите явления:</p>
<ol class="simple">
<li><p>Сезонность - Аденовирус, пневмония, хламидия, параинфлюенза.</p></li>
<li><p>Согласие в 2014 между динамикой бореллии и ротавируса.</p></li>
<li><p>Влияние фактора возраста - аденовирус, ВИЧ, пневмония.</p></li>
</ol>
<p>Набор данных, которыми оперирует приложение <span id="id2">[<a class="reference internal" href="references.html#id8"><span>MDL+16</span></a>]</span>, содержит колонки:</p>
<ul class="simple">
<li><p>Age возраст пациента (в годах);</p></li>
<li><p>DateMonday дата понедельника недели, когда делали запись;</p></li>
<li><p>Gender пол пациента;</p></li>
<li><p>Subject категория заболевания (возбудитель);</p></li>
<li><p>NUTS2 административное подразделение Бельгии, где сделали запись.</p></li>
</ul>
<p>Каждая строчка в наборе данных - это запись о заболевании конкретного человека. Т.е. по одной записи можно установить, когда и с кем случилась неприятность. В некоторых случаях это серьезные заболевания вроде СПИД.</p>
<p>Однако, при анализе нас интересует количество случаев заболеваний за период времени в том или ином районе среди той или иной части населения.
Чтобы получать такие числа мы должны правильно отбирать строки в таблице и просто считать количество строк в полученных выборках.</p>
<p><em>Эпидемиология</em> - наука на стыке микробиологии и социологии.</p>
<p>Загрузим набор данных и попробуем автоматизировать некоторые задачи.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">D</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;d/epistat.csv&quot;</span><span class="p">)</span>  <span class="c1">#https://epistat.wiv-isp.be/data/public_cases.csv&quot;)</span>
<span class="n">D</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 295320 entries, 0 to 295319
Data columns (total 5 columns):
 #   Column      Non-Null Count   Dtype  
---  ------      --------------   -----  
 0   Age         289056 non-null  float64
 1   DateMonday  295320 non-null  object 
 2   Gender      295320 non-null  object 
 3   Subject     295320 non-null  object 
 4   NUTS2       282641 non-null  float64
dtypes: float64(2), object(3)
memory usage: 11.3+ MB
</pre></div>
</div>
</div>
</div>
<p>Как видно из количества ненулевых значений в наборе данных есть незначительное количество пропусков в данных о возрасте и регионе.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">D</span><span class="o">.</span><span class="n">Age</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">);</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Возраст&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_9_0.png" src="_images/i_epistat_9_0.png" />
</div>
</div>
<p>На гистограмме выделяются две возрастные группы, подверженные инфекционным заболеваниям - дети до 7 лет и молодежь после 20.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">D</span><span class="o">.</span><span class="n">Gender</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>M      151441
F      140440
U        2316
UNK      1123
Name: Gender, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Пол хоть и указан во всех записях, но обозначения U и UNK вставлены на местах отсутствующих значений.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">D</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">D</span><span class="o">.</span><span class="n">Gender</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;UNK&#39;</span><span class="p">]),</span> <span class="s1">&#39;Gender&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NaN</span>
<span class="n">D</span><span class="o">.</span><span class="n">Gender</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>M    151441
F    140440
Name: Gender, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Информация о возбудителях закодирована коротким кодом.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">D</span><span class="o">.</span><span class="n">Subject</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>V_RSV     65945
CAM_SP    54545
CHLTRA    34782
SALM      26764
V_RTV     17332
V_ADV     12355
BRRBUR    12283
GIA_SP    10109
HIV        9006
V_PIV      8412
PNEU       8291
NEIGON     7727
V_HCV      7596
CRS_SP     3187
BORPER     2998
SHIG       2941
STRPYO     2612
YERENT     2211
ENTHIS     1555
V_HAV      1302
HAEINF      839
V_HTV       668
LIS_SP      579
MENI        558
VTEC        510
CHIK        135
CHLPSI       77
ZIKA          1
Name: Subject, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Преобладают простудные и кишечные инфекции. Странный единичный случай <a class="reference external" href="https://ru.wikipedia.org/wiki/%D0%92%D0%B8%D1%80%D1%83%D1%81_%D0%97%D0%B8%D0%BA%D0%B0">вируса Зика</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">D</span><span class="p">[</span><span class="n">D</span><span class="o">.</span><span class="n">Subject</span><span class="o">==</span><span class="s1">&#39;ZIKA&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Age</th>
      <th>DateMonday</th>
      <th>Gender</th>
      <th>Subject</th>
      <th>NUTS2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>247437</th>
      <td>27.0</td>
      <td>2015-12-07</td>
      <td>F</td>
      <td>ZIKA</td>
      <td>31.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Короткие кодовые названия часто используются в больших таблицах для формирования колонок фиксированной ширины. Также короткие обозначения удобны для подписей в рисунках. Однако латинские названия возбудителей гораздо понятнее.</p>
<p>Создадим словарик соответствия кода и латинского названия. Структура данных <code class="docutils literal notranslate"><span class="pre">dict</span></code> используется для удобного доступа к множеству значений по ключу (коду).</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kod_spec</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;BORPER&#39;</span><span class="p">:</span><span class="s1">&#39;Bordetella pertussis&#39;</span><span class="p">,</span>
    <span class="s1">&#39;BRRBUR&#39;</span><span class="p">:</span><span class="s1">&#39;Borrelia burgdorferi&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CAM_SP&#39;</span><span class="p">:</span><span class="s1">&#39;Campylobacter sp.&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CHIK  &#39;</span><span class="p">:</span><span class="s1">&#39;Chikungunya virus&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CHLPSI&#39;</span><span class="p">:</span><span class="s1">&#39;Chlamydia psittaci&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CHLTRA&#39;</span><span class="p">:</span><span class="s1">&#39;Chlamydia trachomatis&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CRS_SP&#39;</span><span class="p">:</span><span class="s1">&#39;Cryptosporidium&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ENTHIS&#39;</span><span class="p">:</span><span class="s1">&#39;Entamoeba histolytica&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GIA_SP&#39;</span><span class="p">:</span><span class="s1">&#39;Giardia sp.&#39;</span><span class="p">,</span>
    <span class="s1">&#39;HAEINF&#39;</span><span class="p">:</span><span class="s1">&#39;Haemophilus influenzae&#39;</span><span class="p">,</span>
    <span class="s1">&#39;HIV   &#39;</span><span class="p">:</span><span class="s1">&#39;Lentivirus &quot;HIV&quot;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;LIS_SP&#39;</span><span class="p">:</span><span class="s1">&#39;Listeria monocytogenes&#39;</span><span class="p">,</span>
    <span class="s1">&#39;MENI  &#39;</span><span class="p">:</span><span class="s1">&#39;Neisseria meningitidis&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NEIGON&#39;</span><span class="p">:</span><span class="s1">&#39;Neisseria gonorrhoeae&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PNEU  &#39;</span><span class="p">:</span><span class="s1">&#39;Streptococcus pneumoniae&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SALM  &#39;</span><span class="p">:</span><span class="s1">&#39;Salmonella&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SHIG  &#39;</span><span class="p">:</span><span class="s1">&#39;Shigella&#39;</span><span class="p">,</span>
    <span class="s1">&#39;STRPYO&#39;</span><span class="p">:</span><span class="s1">&#39;Streptococcus pyogenes&#39;</span><span class="p">,</span>
    <span class="s1">&#39;VTEC  &#39;</span><span class="p">:</span><span class="s1">&#39;Escherichia coli &quot;VTEC&quot;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;V_ADV &#39;</span><span class="p">:</span><span class="s1">&#39;Adenovirus&#39;</span><span class="p">,</span>
    <span class="s1">&#39;V_HAV &#39;</span><span class="p">:</span><span class="s1">&#39;Hepatitis A virus&#39;</span><span class="p">,</span>
    <span class="s1">&#39;V_HCV &#39;</span><span class="p">:</span><span class="s1">&#39;Hepatitis C virus&#39;</span><span class="p">,</span>
    <span class="s1">&#39;V_HTV &#39;</span><span class="p">:</span><span class="s1">&#39;Hantavirus&#39;</span><span class="p">,</span>
    <span class="s1">&#39;V_PIV &#39;</span><span class="p">:</span><span class="s1">&#39;Parainfluenza&#39;</span><span class="p">,</span>
    <span class="s1">&#39;V_RSV &#39;</span><span class="p">:</span><span class="s1">&#39;Respiratory Syncytial Virus&#39;</span><span class="p">,</span>
    <span class="s1">&#39;V_RTV &#39;</span><span class="p">:</span><span class="s1">&#39;Rotavirus&#39;</span><span class="p">,</span>
    <span class="s1">&#39;YERENT&#39;</span><span class="p">:</span><span class="s1">&#39;Yersinia enterocolitica&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ZIKA  &#39;</span><span class="p">:</span><span class="s1">&#39;Flavivirus &quot;ZIKA&quot;&#39;</span><span class="p">,</span>
<span class="p">}</span>
<span class="c1"># пробелы проще вычистить в цикле</span>
<span class="n">kod_spec</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">kod_spec</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;BORPER&#39;: &#39;Bordetella pertussis&#39;,
 &#39;BRRBUR&#39;: &#39;Borrelia burgdorferi&#39;,
 &#39;CAM_SP&#39;: &#39;Campylobacter sp.&#39;,
 &#39;CHIK&#39;: &#39;Chikungunya virus&#39;,
 &#39;CHLPSI&#39;: &#39;Chlamydia psittaci&#39;,
 &#39;CHLTRA&#39;: &#39;Chlamydia trachomatis&#39;,
 &#39;CRS_SP&#39;: &#39;Cryptosporidium&#39;,
 &#39;ENTHIS&#39;: &#39;Entamoeba histolytica&#39;,
 &#39;GIA_SP&#39;: &#39;Giardia sp.&#39;,
 &#39;HAEINF&#39;: &#39;Haemophilus influenzae&#39;,
 &#39;HIV&#39;: &#39;Lentivirus &quot;HIV&quot;&#39;,
 &#39;LIS_SP&#39;: &#39;Listeria monocytogenes&#39;,
 &#39;MENI&#39;: &#39;Neisseria meningitidis&#39;,
 &#39;NEIGON&#39;: &#39;Neisseria gonorrhoeae&#39;,
 &#39;PNEU&#39;: &#39;Streptococcus pneumoniae&#39;,
 &#39;SALM&#39;: &#39;Salmonella&#39;,
 &#39;SHIG&#39;: &#39;Shigella&#39;,
 &#39;STRPYO&#39;: &#39;Streptococcus pyogenes&#39;,
 &#39;VTEC&#39;: &#39;Escherichia coli &quot;VTEC&quot;&#39;,
 &#39;V_ADV&#39;: &#39;Adenovirus&#39;,
 &#39;V_HAV&#39;: &#39;Hepatitis A virus&#39;,
 &#39;V_HCV&#39;: &#39;Hepatitis C virus&#39;,
 &#39;V_HTV&#39;: &#39;Hantavirus&#39;,
 &#39;V_PIV&#39;: &#39;Parainfluenza&#39;,
 &#39;V_RSV&#39;: &#39;Respiratory Syncytial Virus&#39;,
 &#39;V_RTV&#39;: &#39;Rotavirus&#39;,
 &#39;YERENT&#39;: &#39;Yersinia enterocolitica&#39;,
 &#39;ZIKA&#39;: &#39;Flavivirus &quot;ZIKA&quot;&#39;}
</pre></div>
</div>
</div>
</div>
<p>В библиотеке <code class="docutils literal notranslate"><span class="pre">pandas</span></code> аналогом словаря  служит серия <code class="docutils literal notranslate"><span class="pre">pd.Series</span></code>, которая позволяет отбирать по нескольку названий по кодам.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">species</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">kod_spec</span><span class="p">)</span>
<span class="n">species</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BORPER           Bordetella pertussis
BRRBUR           Borrelia burgdorferi
CAM_SP              Campylobacter sp.
CHIK                Chikungunya virus
CHLPSI             Chlamydia psittaci
CHLTRA          Chlamydia trachomatis
CRS_SP                Cryptosporidium
ENTHIS          Entamoeba histolytica
GIA_SP                    Giardia sp.
HAEINF         Haemophilus influenzae
HIV                  Lentivirus &quot;HIV&quot;
LIS_SP         Listeria monocytogenes
MENI           Neisseria meningitidis
NEIGON          Neisseria gonorrhoeae
PNEU         Streptococcus pneumoniae
SALM                       Salmonella
SHIG                         Shigella
STRPYO         Streptococcus pyogenes
VTEC          Escherichia coli &quot;VTEC&quot;
V_ADV                      Adenovirus
V_HAV               Hepatitis A virus
V_HCV               Hepatitis C virus
V_HTV                      Hantavirus
V_PIV                   Parainfluenza
V_RSV     Respiratory Syncytial Virus
V_RTV                       Rotavirus
YERENT        Yersinia enterocolitica
ZIKA                Flavivirus &quot;ZIKA&quot;
dtype: object
</pre></div>
</div>
</div>
</div>
<p>Если заглянуть в <a href=view-source:https://epistat.wiv-isp.be/>исходный код веб-страницы</a> (нажать Ctrl-U на сайте Epistat), то можно найти много других расшифровок кодовых обозначений в таблице.</p>
<blockquote>
<div><p>Определите, кто скрывается за аббревиатурами:</p>
</div></blockquote>
<ul class="simple">
<li><p>TUBECULT  (неужели культ ютуба?)</p></li>
<li><p>TREPAL</p></li>
<li><p>HANTA</p></li>
</ul>
<p>Код на JavaScript содержит также информацию о соответствии кодов провинций и названий.
Информацию о названиях региона можно извлечь с помощью регулярных выражений следующим образом.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;case 10:</span>
<span class="s1">          e.province = &#39;Brussels&#39;;</span>
<span class="s1">          break;</span>
<span class="s1">        case 21:</span>
<span class="s1">          e.province = &#39;Antwerp&#39;;</span>
<span class="s1">          break;</span>
<span class="s1">        case 22:</span>
<span class="s1">          e.province = &#39;Limburg&#39;;</span>
<span class="s1">          break;</span>
<span class="s1">        case 23:</span>
<span class="s1">          e.province = &#39;East Flanders&#39;;</span>
<span class="s1">          break;</span>
<span class="s1">        case 24:</span>
<span class="s1">          e.province = &#39;Flemish Brabant&#39;;</span>
<span class="s1">          break;</span>
<span class="s1">        case 25:</span>
<span class="s1">          e.province = &#39;West Flanders&#39;;</span>
<span class="s1">          break;</span>
<span class="s1">        case 31:</span>
<span class="s1">          e.province = &#39;Walloon Brabant&#39;;</span>
<span class="s1">          break;</span>
<span class="s1">        case 32:</span>
<span class="s1">          e.province = &#39;Hainaut&#39;;</span>
<span class="s1">          break;</span>
<span class="s1">        case 33:</span>
<span class="s1">          e.province = &#39;Liege&#39;;</span>
<span class="s1">          break;</span>
<span class="s1">        case 34:</span>
<span class="s1">          e.province = &#39;Luxembourg&#39;;</span>
<span class="s1">          break;</span>
<span class="s1">        case 35:</span>
<span class="s1">          e.province = &#39;Namur&#39;;</span>
<span class="s1">          break;</span>
<span class="s1">        default:</span>
<span class="s1">          e.province = &#39;Unknown&#39;</span>
<span class="s1">      }&#39;&#39;&#39;</span>
<span class="n">tutu</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;case (?P&lt;code&gt;\d+):.+?\.province = </span><span class="se">\&#39;</span><span class="s1">(?P&lt;name&gt;[\w ]+?)</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)</span>
<span class="n">tutu</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;10&#39;, &#39;Brussels&#39;),
 (&#39;21&#39;, &#39;Antwerp&#39;),
 (&#39;22&#39;, &#39;Limburg&#39;),
 (&#39;23&#39;, &#39;East Flanders&#39;),
 (&#39;24&#39;, &#39;Flemish Brabant&#39;),
 (&#39;25&#39;, &#39;West Flanders&#39;),
 (&#39;31&#39;, &#39;Walloon Brabant&#39;),
 (&#39;32&#39;, &#39;Hainaut&#39;),
 (&#39;33&#39;, &#39;Liege&#39;),
 (&#39;34&#39;, &#39;Luxembourg&#39;),
 (&#39;35&#39;, &#39;Namur&#39;)]
</pre></div>
</div>
</div>
</div>
<p>Пары значений NUTS2-провинция мы можем оформить в виде таблички.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">tutu</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Province&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
<span class="n">A</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">A</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Province</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10</th>
      <td>Brussels</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Antwerp</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Limburg</td>
    </tr>
    <tr>
      <th>23</th>
      <td>East Flanders</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Flemish Brabant</td>
    </tr>
    <tr>
      <th>25</th>
      <td>West Flanders</td>
    </tr>
    <tr>
      <th>31</th>
      <td>Walloon Brabant</td>
    </tr>
    <tr>
      <th>32</th>
      <td>Hainaut</td>
    </tr>
    <tr>
      <th>33</th>
      <td>Liege</td>
    </tr>
    <tr>
      <th>34</th>
      <td>Luxembourg</td>
    </tr>
    <tr>
      <th>35</th>
      <td>Namur</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>На всякий случай можем добавить численность населения провинций.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;switch (e.NUTS2) {</span>
<span class="s1">        case 10:</span>
<span class="s1">          e.incidence = 100000 / 1119088;</span>
<span class="s1">          break;</span>
<span class="s1">        case 21:</span>
<span class="s1">          e.incidence = 100000 / 1764773;</span>
<span class="s1">          break;</span>
<span class="s1">        case 22:</span>
<span class="s1">          e.incidence = 100000 / 844621;</span>
<span class="s1">          break;</span>
<span class="s1">        case 23:</span>
<span class="s1">          e.incidence = 100000 / 1445831;</span>
<span class="s1">          break;</span>
<span class="s1">        case 24:</span>
<span class="s1">          e.incidence = 100000 / 1086446;</span>
<span class="s1">          break;</span>
<span class="s1">        case 25:</span>
<span class="s1">          e.incidence = 100000 / 1164967;</span>
<span class="s1">          break;</span>
<span class="s1">        case 31:</span>
<span class="s1">          e.incidence = 100000 / 382866;</span>
<span class="s1">          break;</span>
<span class="s1">        case 32:</span>
<span class="s1">          e.incidence = 100000 / 1317284;</span>
<span class="s1">          break;</span>
<span class="s1">        case 33:</span>
<span class="s1">          e.incidence = 100000 / 1077203;</span>
<span class="s1">          break;</span>
<span class="s1">        case 34:</span>
<span class="s1">          e.incidence = 100000 / 271352;</span>
<span class="s1">          break;</span>
<span class="s1">        case 35:</span>
<span class="s1">          e.incidence = 100000 / 476835;</span>
<span class="s1">          break;</span>
<span class="s1">        default:</span>
<span class="s1">          e.incidence = 0.1</span>
<span class="s1">&#39;&#39;&#39;</span>
<span class="n">tutu</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;case (?P&lt;code&gt;\d+):.+?\.incidence = 100000 / (?P&lt;num&gt;\d+)&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)</span>
<span class="n">popu</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">tutu</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Population&#39;</span><span class="p">)</span>
<span class="n">popu</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">popu</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">A</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">popu</span><span class="p">)</span>
<span class="n">A</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Province</th>
      <th>Population</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10</th>
      <td>Brussels</td>
      <td>1119088</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Antwerp</td>
      <td>1764773</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Limburg</td>
      <td>844621</td>
    </tr>
    <tr>
      <th>23</th>
      <td>East Flanders</td>
      <td>1445831</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Flemish Brabant</td>
      <td>1086446</td>
    </tr>
    <tr>
      <th>25</th>
      <td>West Flanders</td>
      <td>1164967</td>
    </tr>
    <tr>
      <th>31</th>
      <td>Walloon Brabant</td>
      <td>382866</td>
    </tr>
    <tr>
      <th>32</th>
      <td>Hainaut</td>
      <td>1317284</td>
    </tr>
    <tr>
      <th>33</th>
      <td>Liege</td>
      <td>1077203</td>
    </tr>
    <tr>
      <th>34</th>
      <td>Luxembourg</td>
      <td>271352</td>
    </tr>
    <tr>
      <th>35</th>
      <td>Namur</td>
      <td>476835</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">D</span><span class="o">.</span><span class="n">NUTS2</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([32., 23., 22., 21., 10., 24., 31., nan, 33., 25., 35., 34.])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">D</span><span class="o">.</span><span class="n">NUTS2</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">NUTS2</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">A</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Province&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id3">
<h2>Подготовка данных про инфекционные заболевания<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h2>
<p>Для удобства сделаем колонки для отбора по годам и по месяцам.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">D</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">DateMonday</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">D</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2015    42679
2012    40957
2013    40794
2014    39773
2011    37556
2008    31695
2010    31421
2009    30445
Name: Y, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">D</span><span class="p">[</span><span class="s1">&#39;YM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">DateMonday</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>

<span class="n">D</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">DateMonday</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">D</span><span class="o">.</span><span class="n">M</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1     24352
2     20684
3     24863
4     20825
5     19795
6     21279
7     17888
8     20329
9     20575
10    22538
11    39180
12    43012
Name: M, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Для удобства можно добавить новые колонки с латинскими названиями возбудителей и названиями провинций.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">D</span><span class="p">[</span><span class="s1">&#39;Species&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">Subject</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">code</span><span class="p">:</span> <span class="n">species</span><span class="p">[</span><span class="n">code</span><span class="p">])</span>
<span class="n">D</span><span class="p">[</span><span class="s1">&#39;Province&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">NUTS2</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">code</span><span class="p">:</span> <span class="n">A</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">code</span><span class="p">,</span><span class="s1">&#39;Province&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id4">
<h2>Анализ пустот<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h2>
<p>Перед тем как делать обобщающие выводы по результатам решения задач, прикинем полноту представленных в наборе записей.</p>
<p>Чувствительные данные, относящиеся к самим пациентам, могут отсутствовать умышленно из соображений анонимности при сборе данных. Колонки возраст, пол и провинция могут косвенно указывать на носителей заболевания.</p>
<p>Посмотрим, для каких возбудителей чаще всего не указана провинция.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">D</span><span class="p">[</span><span class="n">D</span><span class="p">[</span><span class="s1">&#39;Province&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;-&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Species</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Salmonella                     2999
Lentivirus &quot;HIV&quot;               2369
Campylobacter sp.              1484
Respiratory Syncytial Virus    1453
Chlamydia trachomatis           940
Rotavirus                       498
Giardia sp.                     404
Hepatitis C virus               342
Borrelia burgdorferi            334
Adenovirus                      328
Neisseria gonorrhoeae           287
Shigella                        273
Parainfluenza                   204
Entamoeba histolytica           152
Streptococcus pneumoniae        110
Bordetella pertussis             95
Cryptosporidium                  86
Streptococcus pyogenes           76
Yersinia enterocolitica          63
Hepatitis A virus                47
Listeria monocytogenes           41
Haemophilus influenzae           30
Hantavirus                       29
Escherichia coli &quot;VTEC&quot;          22
Neisseria meningitidis           11
Chikungunya virus                 1
Chlamydia psittaci                1
Name: Species, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Интересно, много случаев СПИД без указания провинции. Еще больше сальмонеллёза. Давайте рассчитаем процент «скрытых» адресов относительно общей численности записей по каждой инфекции.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="n">D</span><span class="p">[</span><span class="s1">&#39;Province&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;-&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Species</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span> <span class="o">/</span> <span class="n">D</span><span class="o">.</span><span class="n">Species</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Chikungunya virus               0.740741
Chlamydia psittaci              1.298701
Streptococcus pneumoniae        1.326740
Neisseria meningitidis          1.971326
Respiratory Syncytial Virus     2.203351
Parainfluenza                   2.425107
Adenovirus                      2.654796
Cryptosporidium                 2.698463
Chlamydia trachomatis           2.702547
Borrelia burgdorferi            2.719205
Campylobacter sp.               2.720689
Yersinia enterocolitica         2.849389
Rotavirus                       2.873298
Streptococcus pyogenes          2.909648
Bordetella pertussis            3.168779
Haemophilus influenzae          3.575685
Hepatitis A virus               3.609831
Neisseria gonorrhoeae           3.714249
Giardia sp.                     3.996439
Escherichia coli &quot;VTEC&quot;         4.313725
Hantavirus                      4.341317
Hepatitis C virus               4.502370
Listeria monocytogenes          7.081174
Shigella                        9.282557
Entamoeba histolytica           9.774920
Salmonella                     11.205350
Lentivirus &quot;HIV&quot;               26.304686
Flavivirus &quot;ZIKA&quot;                    NaN
Name: Species, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Действительно, чаще всего фиксировались без указания адреса случаи заражения ВИЧ (HIV) - 26% от всей статистики.</p>
<p>А что с возрастом инфицированных ВИЧ в Бельгии?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">D</span><span class="p">[(</span><span class="n">D</span><span class="o">.</span><span class="n">Subject</span><span class="o">==</span><span class="s1">&#39;HIV&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">Age</span><span class="o">.</span><span class="n">notnull</span><span class="p">())]</span>

<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">Province</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Age</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Без адреса&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">Province</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Age</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Провинция указана&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_44_0.png" src="_images/i_epistat_44_0.png" />
</div>
</div>
<p>Большинство случаев заражения ВИЧ в детском возрасте (до 15 лет) в базе без указания адреса. В остальном распределения примерно совпадают.</p>
<p>А при каких заболеваниях чаще не указывали возраст?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="n">D</span><span class="o">.</span><span class="n">Age</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span><span class="o">.</span><span class="n">Species</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span> <span class="o">/</span> <span class="n">D</span><span class="o">.</span><span class="n">Species</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Salmonella                     9.247497
Shigella                       3.264196
Neisseria gonorrhoeae          2.588327
Respiratory Syncytial Virus    2.312533
Chlamydia trachomatis          1.811282
Entamoeba histolytica          1.672026
Streptococcus pneumoniae       1.616210
Cryptosporidium                1.506119
Bordetella pertussis           1.501001
Neisseria meningitidis         1.433692
Hepatitis A virus              1.382488
Escherichia coli &quot;VTEC&quot;        1.176471
Giardia sp.                    1.147492
Hepatitis C virus              0.974197
Adenovirus                     0.874140
Listeria monocytogenes         0.863558
Borrelia burgdorferi           0.854840
Yersinia enterocolitica        0.814111
Campylobacter sp.              0.790173
Haemophilus influenzae         0.715137
Rotavirus                      0.675052
Streptococcus pyogenes         0.421133
Lentivirus &quot;HIV&quot;               0.410837
Hantavirus                     0.299401
Parainfluenza                  0.273419
Chikungunya virus                   NaN
Chlamydia psittaci                  NaN
Flavivirus &quot;ZIKA&quot;                   NaN
Name: Species, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Сальмонеллез - кишечная инфекция. Ничего особенного.</p>
</div>
<div class="section" id="id5">
<h2>Динамика<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h2>
<p>При рассмотрении динамики заболеваемости во времени важно четко представлять иерархичность циклов, которыми оперируют эпидемиологи (как и другие люди).</p>
<p>Глобальные тренды оценивают по годам.
Внутри года смотрят помесячную динамику.
В данном наборе минимальный срок - неделя, которая имеет четкую длительность - 7 дней.</p>
<p>Проблема осложняется тем, что в месяце нет четкого количества недель, потому что количество дней в разных месяцах варьирует.
Для правильного пересчета значений в иные периодические шкалы нужно использовать календарь. Функционал пересчета дат и периодов из одной шкалы в другую поддерживается в библиотеке <code class="docutils literal notranslate"><span class="pre">pandas</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># создадим новую колонку, которая будет содержать объекты типа `datetime64`, со значениями, </span>
<span class="c1"># дублирующими колонку DateMonday, которая содержит строки из 10 символов.</span>
<span class="n">D</span><span class="p">[</span><span class="s1">&#39;W&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="s1">&#39;DateMonday&#39;</span><span class="p">])</span>
<span class="c1"># Чтобы легко было суммировать случаи заболевания, добавим в каждую строку по единице.</span>
<span class="n">D</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Теперь полученную колонку сделаем индексом</span>
<span class="n">D</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Индекс преобразуем в период - вместо одного дня понедельника будет диапазон из 7 дней</span>
<span class="n">D</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">D</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Time&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>При трактовке динамики полезно понимать к какому типу инфекции относится то или иное заболевание.</p>
<p>Эпидемиологические вспышки напрямую зависят от способа заражения. А он принципиально разный для:</p>
<ul class="simple">
<li><p>простудно-легочных заболеваний (Bordetella, Streptococcus, Haemophilus)</p></li>
<li><p>кишечных расстройств (Shigella, Salmonella, Giardia)</p></li>
<li><p>ЗППП (Neisseria gonorrhoeae, Chlamydia trachomatis)</p></li>
<li><p>в общем безвредных паразитов, которые в редких случаях переходят в тяжелые системные заболевания (дизентерийная амёба, ВИЧ, Borrelia, Listeria, Neisseria meningitidis)</p></li>
</ul>
<p>Предсказуемость динамики заболеваемости осложняется тем, что безобидный микроорганизм, который легко распознается и ликвидируется иммунными клетками, в отдельных случаях приводит к заболеванию.
Самый яркий пример - детские инфекции. Несмотря на то, что у новорожденных сильный иммунитет, часть которого приобретена пассивно через плаценту, при встрече с некоторыми микропаразитами врожденный иммунитет бессилен. А значит каждому ребенку «надо переболеть» ротавирусной (понос) или аденовирусной (сопли) инфекциями.</p>
<div class="section" id="id6">
<h3>Сезонная динамика<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h3>
<p>Восприимчивость к патогенам зависит от погоды: зимой легче заболевают одними инфекционными болезнями, летом - другими.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">D</span><span class="o">.</span><span class="n">Species</span><span class="o">==</span><span class="s1">&#39;Rotavirus&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Для отображения динамики мы должны сгруппировать записи по неделям, сосчитать количество случаев в каждой группе и нарисовать график.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_57_0.png" src="_images/i_epistat_57_0.png" />
</div>
</div>
<p>Так в колонке <code class="docutils literal notranslate"><span class="pre">n</span></code> одни единички, можно вместо подсчета использовать сумму. График будет тот же самый.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_59_0.png" src="_images/i_epistat_59_0.png" />
</div>
</div>
<p>Для наложения графиков годовой динамики один поверх другого нужно сделать то же самое, но для выборки по каждому году. При итерации групп в цикле мы на каждом шаге получаем имя группы и выборку строк для этой группы.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">glabel</span><span class="p">,</span><span class="n">g</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span>
    <span class="c1"># группируем по неделям и берем суммарные значения</span>
    <span class="n">vv</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>    
    <span class="n">plot</span><span class="p">(</span><span class="n">vv</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">glabel</span><span class="p">)</span>

<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Номер недели&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Заболеваний / нед&#39;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_61_0.png" src="_images/i_epistat_61_0.png" />
</div>
</div>
<p>Четко виден резкий рост заболеваемости на 5-10 неделях года.</p>
<p>Для более гладкой динамики можно сгруппировать по месяцам.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">glabel</span><span class="p">,</span><span class="n">g</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">):</span>
    <span class="c1"># группируем по неделям и берем суммарные значения</span>
    <span class="n">vv</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="c1">#.values</span>
    
    <span class="n">plot</span><span class="p">(</span><span class="n">vv</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">glabel</span><span class="p">)</span>

<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Месяц&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Заболеваний / мес&#39;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_63_0.png" src="_images/i_epistat_63_0.png" />
</div>
</div>
<p>Напомним возрастной состав заболевших ротавирусной инфекцией.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">Age</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_65_0.png" src="_images/i_epistat_65_0.png" />
</div>
</div>
<p>Маленькие дети и несколько глубоких старичков.</p>
<p>Рассмотрим детальней каждую категорию с учетом пола. При наложении нескольких распределений удобно строить ядерные оценки плотности (KDE, Kernel Density Estimation).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">Age</span><span class="o">&gt;</span><span class="mi">60</span><span class="p">]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">X_</span><span class="p">[</span><span class="n">X_</span><span class="o">.</span><span class="n">Gender</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Age</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;cyan&#39;</span><span class="p">);</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">X_</span><span class="p">[</span><span class="n">X_</span><span class="o">.</span><span class="n">Gender</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Age</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;coral&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_67_0.png" src="_images/i_epistat_67_0.png" />
</div>
</div>
<p>Если строить классические гистограммы, то полупрозрачность дает возможность легко обнаруживать преобладание той или другой группы.</p>
<p>Так как возраст указан с точностью до года, то для подробной гистограммы лучше задать не количество классов, а список границ классов, тогда каждому году будет четко соответствовать один столбик.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">Age</span><span class="o">&lt;</span><span class="mi">20</span><span class="p">]</span>
<span class="n">classes</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
<span class="n">hist</span><span class="p">(</span><span class="n">X_</span><span class="p">[</span><span class="n">X_</span><span class="o">.</span><span class="n">Gender</span> <span class="o">==</span> <span class="s1">&#39;M&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Age</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;cyan&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">classes</span><span class="p">);</span>
<span class="n">hist</span><span class="p">(</span><span class="n">X_</span><span class="p">[</span><span class="n">X_</span><span class="o">.</span><span class="n">Gender</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Age</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;coral&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">classes</span><span class="p">);</span>
<span class="n">xticks</span><span class="p">(</span><span class="n">classes</span><span class="o">+.</span><span class="mi">5</span><span class="p">,</span> <span class="n">classes</span><span class="p">)</span>
<span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_69_0.png" src="_images/i_epistat_69_0.png" />
</div>
</div>
<p>А старички также болеют весной?</p>
<p>Наложим нормализованную динамику для двух возрастных групп.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">Age</span><span class="o">&gt;</span><span class="mi">60</span><span class="p">]</span>
<span class="p">(</span><span class="n">X_</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">X_</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;старички&#39;</span><span class="p">);</span>
<span class="n">X_</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">Age</span><span class="o">&lt;</span><span class="mi">8</span><span class="p">]</span>
<span class="p">(</span><span class="n">X_</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">X_</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;груднички&#39;</span><span class="p">);</span>
<span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_71_0.png" src="_images/i_epistat_71_0.png" />
</div>
</div>
<p>Да, тоже по весне, но не так регулярно из-за малого количества случаев.</p>
</div>
<div class="section" id="id7">
<h3>Годовая динамика<a class="headerlink" href="#id7" title="Ссылка на этот заголовок">¶</a></h3>
<p>Почему же все-таки в 2014 году была аномалия в заболеваемости ротавирусной инфекцией?
Почему детки из северной Бельгии в марте 2014 болели мало, а переболели только в следующем 2015 году?</p>
<p>Чтобы ответить на этот вопрос удобно рассмотреть изменения между годами независимо от изменений внутри года. Расположим оси смены лет и смены месяцев перпендикулярно, как это мы уже делали для визуализации температурных изменений.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># momo = [datetime.date.strftime(x,&#39;%b&#39;) for x in pd.DatetimeIndex(start=&#39;2000-01&#39;, end=&#39;2001-01&#39;, freq=&#39;M&#39;)]</span>
<span class="n">momo</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;%b&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;2000-01&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;2001-01&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)]</span>

<span class="n">N</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
<span class="n">N</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">momo</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_75_0.png" src="_images/i_epistat_75_0.png" />
</div>
</div>
<p>Группировка по двум осям является типичной операцией, поэтому есть специальный метод - на русский переводится как «сводная таблица».</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">)</span>
<span class="n">N</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">momo</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_77_0.png" src="_images/i_epistat_77_0.png" />
</div>
</div>
<p>Давайте посмотрим отдельно для грудничков и годовалых младенцев.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

<span class="k">for</span> <span class="n">iage</span><span class="p">,</span> <span class="n">age</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]):</span>
    <span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">iage</span><span class="p">])</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">Age</span><span class="o">==</span><span class="n">age</span><span class="p">]</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">)</span>
    <span class="n">N</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">momo</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">);</span>
    <span class="n">title</span><span class="p">(</span><span class="s1">&#39;Age = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">age</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_79_0.png" src="_images/i_epistat_79_0.png" />
</div>
</div>
<p>Паттерн не различался. Значит дело не в возрасте.</p>
<p>Посмотрим паттерн температур для <a class="reference external" href="https://ru.wikipedia.org/wiki/%D0%97%D0%B0%D0%BF%D0%B0%D0%B4%D0%BD%D0%B0%D1%8F_%D0%A4%D0%BB%D0%B0%D0%BD%D0%B4%D1%80%D0%B8%D1%8F">Западной Фландрии</a> с административным центром — городом Брюгге.</p>
<p>По координатам 51°00′ с. ш. 3°00′ в. д. можно найти данные метеорологических станций например с помощью сервиса <a class="reference external" href="http://climexp.knmi.nl/selectstation.cgi">http://climexp.knmi.nl/selectstation.cgi</a> .
Ближайшая станция в <a class="reference external" href="http://climexp.knmi.nl/gettempall.cgi?id=someone&#64;somewhere&amp;WMO=7015&amp;STATION=LILLE&amp;extraargs=">Лилле, Франция</a>.</p>
<p>На исходных данных <a class="reference internal" href="#ta7015"><span class="std std-numref">Рис. 25</span></a> видно отсутствие понижения среднемесячной температуры зимой 2014 года ниже 5 градусов по Цельсию.</p>
<div class="figure align-default" id="ta7015">
<img alt="" src="_images/ta7015_2008-2018.png" />
<p class="caption"><span class="caption-number">Рис. 25 </span><span class="caption-text">Среднемесячная температура в г. Лилль. Источник - <a class="reference external" href="http://climexp.knmi.nl/data/ta7015_2008:2018.png">http://climexp.knmi.nl/data/ta7015_2008:2018.png</a> .</span><a class="headerlink" href="#ta7015" title="Постоянная ссылка на рисунок">¶</a></p>
</div>
<p>Действительно в начале 2014 года температура держалась выше, чем обычно на 2 градуса.</p>
<p>Отобразим эти данных в виде <code class="docutils literal notranslate"><span class="pre">heatmap</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">u</span> <span class="o">=</span> <span class="s1">&#39;http://climexp.knmi.nl/data/ta7015.dat&#39;</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">delim_whitespace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=-</span><span class="mf">999.9</span><span class="p">,</span>
                 <span class="n">names</span><span class="o">=</span><span class="n">momo</span><span class="p">)</span>
<span class="n">T</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Jan</th>
      <th>Feb</th>
      <th>Mar</th>
      <th>Apr</th>
      <th>May</th>
      <th>Jun</th>
      <th>Jul</th>
      <th>Aug</th>
      <th>Sep</th>
      <th>Oct</th>
      <th>Nov</th>
      <th>Dec</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015</th>
      <td>3.8</td>
      <td>3.5</td>
      <td>6.8</td>
      <td>10.4</td>
      <td>13.1</td>
      <td>16.2</td>
      <td>18.8</td>
      <td>19.1</td>
      <td>13.7</td>
      <td>10.6</td>
      <td>10.1</td>
      <td>9.5</td>
    </tr>
    <tr>
      <th>2016</th>
      <td>5.3</td>
      <td>5.3</td>
      <td>6.3</td>
      <td>8.9</td>
      <td>14.4</td>
      <td>16.4</td>
      <td>18.8</td>
      <td>19.1</td>
      <td>18.0</td>
      <td>10.4</td>
      <td>6.6</td>
      <td>4.1</td>
    </tr>
    <tr>
      <th>2017</th>
      <td>1.6</td>
      <td>6.2</td>
      <td>9.7</td>
      <td>9.6</td>
      <td>15.6</td>
      <td>19.4</td>
      <td>19.3</td>
      <td>18.5</td>
      <td>14.5</td>
      <td>13.6</td>
      <td>7.0</td>
      <td>4.9</td>
    </tr>
    <tr>
      <th>2018</th>
      <td>6.2</td>
      <td>1.4</td>
      <td>5.6</td>
      <td>12.7</td>
      <td>15.9</td>
      <td>17.8</td>
      <td>22.3</td>
      <td>19.3</td>
      <td>15.4</td>
      <td>12.5</td>
      <td>7.3</td>
      <td>6.2</td>
    </tr>
    <tr>
      <th>2019</th>
      <td>3.5</td>
      <td>6.6</td>
      <td>9.0</td>
      <td>10.9</td>
      <td>12.6</td>
      <td>18.2</td>
      <td>20.1</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

<span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2008</span><span class="p">:</span><span class="mi">2015</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Температура&#39;</span><span class="p">);</span>


<span class="n">sca</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">N</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">Province</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;West Flanders&#39;</span><span class="p">,</span><span class="s1">&#39;East Flanders&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">)</span>
<span class="n">N</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">momo</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">);</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Заболеваемость ротавирусной инфекцией во Фландрии&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_85_0.png" src="_images/i_epistat_85_0.png" />
</div>
</div>
<p>В 2013 году была относительно холодная зима и март, что сопровождалось всплеском заболеваемости в марте и апреле. В 2014 году было необычно тепло и весеннее обострение прошло без мартовского пика.</p>
<p>Дабы выразить связь в численном виде посчитаем корреляцию между рядами для марта.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span><span class="p">[</span><span class="s1">&#39;Mar&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Заболеваемость&#39;</span><span class="p">)</span>
<span class="n">T</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2008</span><span class="p">:</span><span class="mi">2015</span><span class="p">,</span><span class="s1">&#39;Mar&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="n">secondary_y</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Температура&#39;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_87_0.png" src="_images/i_epistat_87_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corrcoef</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="s1">&#39;Mar&#39;</span><span class="p">],</span> <span class="n">T</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2008</span><span class="p">:</span><span class="mi">2015</span><span class="p">,</span><span class="s1">&#39;Mar&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 1.        , -0.36375115],
       [-0.36375115,  1.        ]])
</pre></div>
</div>
</div>
</div>
<p>Если мы сравниваем два ряда данных, то получаем четыре коэффициента, два из которых 1.0 (сам с собой всегда 1) и два - корреляция между рядами.
В данном случае это заметная отрицательная корреляция.</p>
<p>Из рисунка понятно, что если мы ограничим диапазон лет после 2010 года, то отрицательная корреляция будет еще сильнее.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corrcoef</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2011</span><span class="p">:</span><span class="mi">2015</span><span class="p">,</span> <span class="s1">&#39;Mar&#39;</span><span class="p">],</span> <span class="n">T</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2011</span><span class="p">:</span><span class="mi">2015</span><span class="p">,</span><span class="s1">&#39;Mar&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.41637479283604817
</pre></div>
</div>
</div>
</div>
<p>В 2012 году тоже был теплый март, но перед ним был холодный февраль. Можно усреднить данные за несколько месяцев.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">iiyear</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span><span class="mi">2015</span><span class="p">)</span>
<span class="n">iimo</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Jan&#39;</span><span class="p">,</span><span class="s1">&#39;Feb&#39;</span><span class="p">,</span><span class="s1">&#39;Mar&#39;</span><span class="p">,</span><span class="s1">&#39;Apr&#39;</span><span class="p">,</span><span class="s1">&#39;May&#39;</span><span class="p">]</span>

<span class="n">corrcoef</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">iiyear</span><span class="p">,</span> <span class="n">iimo</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">T</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">iiyear</span><span class="p">,</span> <span class="n">iimo</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.5529228215230547
</pre></div>
</div>
</div>
</div>
<p>Итого мы обнаружили сильную отрицательную корреляцию между температурой в начале весны и масштабом весенней вспышки ротавирусной инфекции среди детей.</p>
<p>Корреляция может быть между любыми сходными по размеру данными.
Например, корреляция изменений температуры в марте с другими месяцами с начала 21-века.
Для таблиц <code class="docutils literal notranslate"><span class="pre">pandas</span></code> есть удобный метод для этого.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">C</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2000</span><span class="p">:</span><span class="mi">2018</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">C</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Jan</th>
      <th>Feb</th>
      <th>Mar</th>
      <th>Apr</th>
      <th>May</th>
      <th>Jun</th>
      <th>Jul</th>
      <th>Aug</th>
      <th>Sep</th>
      <th>Oct</th>
      <th>Nov</th>
      <th>Dec</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Jan</th>
      <td>1.000000</td>
      <td>0.293384</td>
      <td>0.173692</td>
      <td>0.271980</td>
      <td>0.433983</td>
      <td>-0.203485</td>
      <td>-0.314160</td>
      <td>-0.072938</td>
      <td>-0.032642</td>
      <td>-0.095994</td>
      <td>-0.158574</td>
      <td>0.233414</td>
    </tr>
    <tr>
      <th>Feb</th>
      <td>0.293384</td>
      <td>1.000000</td>
      <td>0.451556</td>
      <td>0.254995</td>
      <td>0.309534</td>
      <td>0.026118</td>
      <td>-0.573048</td>
      <td>-0.173683</td>
      <td>0.018472</td>
      <td>-0.067392</td>
      <td>0.130988</td>
      <td>-0.034507</td>
    </tr>
    <tr>
      <th>Mar</th>
      <td>0.173692</td>
      <td>0.451556</td>
      <td>1.000000</td>
      <td>0.176712</td>
      <td>0.348536</td>
      <td>0.408093</td>
      <td>-0.510846</td>
      <td>0.066309</td>
      <td>-0.217353</td>
      <td>-0.182912</td>
      <td>0.070101</td>
      <td>-0.059709</td>
    </tr>
    <tr>
      <th>Apr</th>
      <td>0.271980</td>
      <td>0.254995</td>
      <td>0.176712</td>
      <td>1.000000</td>
      <td>0.174350</td>
      <td>0.169347</td>
      <td>-0.172060</td>
      <td>-0.071371</td>
      <td>0.002518</td>
      <td>0.053499</td>
      <td>0.238175</td>
      <td>0.083499</td>
    </tr>
    <tr>
      <th>May</th>
      <td>0.433983</td>
      <td>0.309534</td>
      <td>0.348536</td>
      <td>0.174350</td>
      <td>1.000000</td>
      <td>0.178999</td>
      <td>-0.109865</td>
      <td>0.106526</td>
      <td>-0.066111</td>
      <td>-0.036186</td>
      <td>0.042643</td>
      <td>0.142281</td>
    </tr>
    <tr>
      <th>Jun</th>
      <td>-0.203485</td>
      <td>0.026118</td>
      <td>0.408093</td>
      <td>0.169347</td>
      <td>0.178999</td>
      <td>1.000000</td>
      <td>0.280509</td>
      <td>0.051595</td>
      <td>0.128666</td>
      <td>0.049547</td>
      <td>-0.112241</td>
      <td>-0.077268</td>
    </tr>
    <tr>
      <th>Jul</th>
      <td>-0.314160</td>
      <td>-0.573048</td>
      <td>-0.510846</td>
      <td>-0.172060</td>
      <td>-0.109865</td>
      <td>0.280509</td>
      <td>1.000000</td>
      <td>-0.087980</td>
      <td>0.146808</td>
      <td>0.228014</td>
      <td>0.000477</td>
      <td>-0.018975</td>
    </tr>
    <tr>
      <th>Aug</th>
      <td>-0.072938</td>
      <td>-0.173683</td>
      <td>0.066309</td>
      <td>-0.071371</td>
      <td>0.106526</td>
      <td>0.051595</td>
      <td>-0.087980</td>
      <td>1.000000</td>
      <td>-0.287177</td>
      <td>-0.506997</td>
      <td>0.019322</td>
      <td>0.154475</td>
    </tr>
    <tr>
      <th>Sep</th>
      <td>-0.032642</td>
      <td>0.018472</td>
      <td>-0.217353</td>
      <td>0.002518</td>
      <td>-0.066111</td>
      <td>0.128666</td>
      <td>0.146808</td>
      <td>-0.287177</td>
      <td>1.000000</td>
      <td>0.195307</td>
      <td>0.138791</td>
      <td>0.053726</td>
    </tr>
    <tr>
      <th>Oct</th>
      <td>-0.095994</td>
      <td>-0.067392</td>
      <td>-0.182912</td>
      <td>0.053499</td>
      <td>-0.036186</td>
      <td>0.049547</td>
      <td>0.228014</td>
      <td>-0.506997</td>
      <td>0.195307</td>
      <td>1.000000</td>
      <td>-0.076999</td>
      <td>0.049747</td>
    </tr>
    <tr>
      <th>Nov</th>
      <td>-0.158574</td>
      <td>0.130988</td>
      <td>0.070101</td>
      <td>0.238175</td>
      <td>0.042643</td>
      <td>-0.112241</td>
      <td>0.000477</td>
      <td>0.019322</td>
      <td>0.138791</td>
      <td>-0.076999</td>
      <td>1.000000</td>
      <td>0.566915</td>
    </tr>
    <tr>
      <th>Dec</th>
      <td>0.233414</td>
      <td>-0.034507</td>
      <td>-0.059709</td>
      <td>0.083499</td>
      <td>0.142281</td>
      <td>-0.077268</td>
      <td>-0.018975</td>
      <td>0.154475</td>
      <td>0.053726</td>
      <td>0.049747</td>
      <td>0.566915</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Чтобы единицы по диагонали не мешали восприятию рисунка, их и половину значений маскируют.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">C</span><span class="p">))</span>
<span class="n">mask</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],
       [0., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],
       [0., 0., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],
       [0., 0., 0., 1., 1., 1., 1., 1., 1., 1., 1., 1.],
       [0., 0., 0., 0., 1., 1., 1., 1., 1., 1., 1., 1.],
       [0., 0., 0., 0., 0., 1., 1., 1., 1., 1., 1., 1.],
       [0., 0., 0., 0., 0., 0., 1., 1., 1., 1., 1., 1.],
       [0., 0., 0., 0., 0., 0., 0., 1., 1., 1., 1., 1.],
       [0., 0., 0., 0., 0., 0., 0., 0., 1., 1., 1., 1.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 1., 1.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 1.],
       [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1.]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_99_0.png" src="_images/i_epistat_99_0.png" />
</div>
</div>
<p>На пересечении месяцев между друг другом выделяются противоположности Июль и Февраль, а также Октябрь и Август. Сходную динамику (высокая положительная корреляция) демонстрируют Февраль-Март и Ноябрь-Декабрь. И, внезапно также Май и Январь.</p>
<p>Тот же прием для данных по годовой динамике заболеваемости ротавирусной инфекцией.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">C</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_102_0.png" src="_images/i_epistat_102_0.png" />
</div>
</div>
</div>
<div class="section" id="id8">
<h3>Разложение на компоненты<a class="headerlink" href="#id8" title="Ссылка на этот заголовок">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">D</span><span class="p">[(</span><span class="n">D</span><span class="o">.</span><span class="n">Subject</span><span class="o">==</span><span class="s1">&#39;CHLTRA&#39;</span><span class="p">)]</span>
<span class="n">X</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_104_0.png" src="_images/i_epistat_104_0.png" />
</div>
</div>
<p>На графике видны колебания, но при этом наблюдается тенденция к увеличению. Компоненты динамики (тренд, сезонная составляющая и др.) можно разделить специальными сезонными моделями из пакета <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.tsa.seasonal</span> <span class="kn">import</span> <span class="n">seasonal_decompose</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">Subject</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">result</span><span class="o">=</span><span class="n">seasonal_decompose</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;multiplicable&#39;</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="mi">52</span><span class="p">)</span>  <span class="c1">#52.1714</span>

<span class="n">result</span><span class="o">.</span><span class="n">trend</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_106_0.png" src="_images/i_epistat_106_0.png" />
</div>
</div>
<p>Несмотря на то, что количество недель в году неточное, сезонная динамика была эффективно выделена в отдельный компонент. Результаты разложения удобно визуализируются в единой шкале.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_108_0.png" src="_images/i_epistat_108_0.png" />
</div>
</div>
</div>
<div class="section" id="id9">
<h3>Фазовые сдвиги<a class="headerlink" href="#id9" title="Ссылка на этот заголовок">¶</a></h3>
<p>Корреляцию можно считать между любыми рядами данных.</p>
<p>В колонках таблицы рассчитаем помесячную динамику. Исключим редкие болезни с невыраженной динамикой. Чтобы подчеркнуть циклические колебания также уберем глобальный тренд.</p>
<p>После вычитания среднего примерно половина значений становится отрицательными. Т.е. значения - это не количество, а отклонение количества от среднего тренда.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;YM&#39;</span><span class="p">,</span><span class="s1">&#39;Species&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
<span class="n">N</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">N</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">1000</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">N</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">detrend</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">N</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">));</span>
<span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.01</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_111_0.png" src="_images/i_epistat_111_0.png" />
</div>
</div>
<p>Резко выделяется ярковыраженной годовой динамикой <a class="reference external" href="https://ru.wikipedia.org/wiki/%D0%A0%D0%B5%D1%81%D0%BF%D0%B8%D1%80%D0%B0%D1%82%D0%BE%D1%80%D0%BD%D0%BE-%D1%81%D0%B8%D0%BD%D1%86%D0%B8%D1%82%D0%B8%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9_%D0%B2%D0%B8%D1%80%D1%83%D1%81_%D1%87%D0%B5%D0%BB%D0%BE%D0%B2%D0%B5%D0%BA%D0%B0">Респираторно-синцитиальный вирус</a>, он же ортопневмовирус человека - возбудитель обычной простуды.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">C</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">C</span><span class="p">))</span>

<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_113_0.png" src="_images/i_epistat_113_0.png" />
</div>
</div>
<p>Однако, временные ряды данных можно коррелировать не только с параллельно изменяющимися во времени, но с самими собой, сдвинутыми по времени. Величина сдвига в шагах периода регистрации сигнала называется лаг.</p>
<p>Если мы сдвигаем ряд с циклической динамикой на несколько шагов, то корреляция падает, затем, когда мы доходим до противофазы (попадаем пиком туда, где ямка), то корреляция становится отрицательной, затем опять повышается. Первый большой пик автокорреляционной функции соответствует периоду основных колебаний.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># pd.tools.plotting.autocorrelation_plot(N[&#39;Hepatitis C virus&#39;]); # old version</span>
<span class="n">pd</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">autocorrelation_plot</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="s1">&#39;Hepatitis C virus&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_115_0.png" src="_images/i_epistat_115_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">autocorrelation_plot</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="s1">&#39;Parainfluenza&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_116_0.png" src="_images/i_epistat_116_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">autocorrelation_plot</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="s1">&#39;Rotavirus&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_117_0.png" src="_images/i_epistat_117_0.png" />
</div>
</div>
<p>Для расчета исходной корреляционной функции без построения рисунка используют соответствующую функцию.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vv</span> <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="s1">&#39;Rotavirus&#39;</span><span class="p">]</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">correlate</span><span class="p">(</span><span class="n">vv</span><span class="p">,</span> <span class="n">vv</span><span class="p">,</span> <span class="s1">&#39;full&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
<span class="n">vv</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((96,), (191,))
</pre></div>
</div>
<img alt="_images/i_epistat_119_1.png" src="_images/i_epistat_119_1.png" />
</div>
</div>
<p>Поскольку мы можем двигать один ряд значений относительно другого и вперед и назад, то полная функция имеет удвоенную длину. На предыдущем готовом рисунке была показана только ее правая половина, причем нормализованная к общей мощности сигнала, чтобы не выходить за рамки диапазона от -1 до 1.</p>
<p>Давайте получим нормализованные значения корреляции.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">:]</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">c</span> <span class="o">/</span> <span class="p">(</span><span class="n">vv</span><span class="o">.</span><span class="n">var</span><span class="p">())</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">c</span><span class="p">);</span> <span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">);</span>
<span class="n">c</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(96,)
</pre></div>
</div>
<img alt="_images/i_epistat_121_1.png" src="_images/i_epistat_121_1.png" />
</div>
</div>
<p>Вместо того, чтобы делить на дисперсию исходного сигнала, правильнее нормализовать входные ряды данных. Мы уже вычли тренд из динамики. Давайте теперь поделим каждую колонку на стандартное отклонение ее значений.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="n">N</span> <span class="o">/</span> <span class="n">N</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">));</span>
<span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.01</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_123_0.png" src="_images/i_epistat_123_0.png" />
</div>
</div>
<p>Резко преобладающие по численности пики ортопневмовируса (RSV) теперь незаметны на фоне остальных.</p>
<p>Годовые циклы имеют лаг в 12 месяцев. Однако какой лаг между динамикой разных заболеваний?
Например, ротавирусной и ортопневмовирусной инфекциями?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vv1</span> <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="s1">&#39;Rotavirus&#39;</span><span class="p">]</span>
<span class="n">vv2</span> <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="s1">&#39;Respiratory Syncytial Virus&#39;</span><span class="p">]</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">correlate</span><span class="p">(</span><span class="n">vv1</span><span class="p">,</span> <span class="n">vv2</span><span class="p">,</span> <span class="s1">&#39;full&#39;</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">:]</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_125_0.png" src="_images/i_epistat_125_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">c</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.6241196119581467, 4)
</pre></div>
</div>
</div>
</div>
<p>Между рядами высокая корреляция - 0.62, но сезонный пик в первом ряду значений сдвинут на 4 месяца относительно сезонного пика во втором ряду значений.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vv1</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">vv2</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_128_0.png" src="_images/i_epistat_128_0.png" />
</div>
</div>
</div>
<div class="section" id="id10">
<h3>Скачкообразная динамика<a class="headerlink" href="#id10" title="Ссылка на этот заголовок">¶</a></h3>
<p>Некоторые болезни «привязаны» к некоторым странам, потому что там живут специфические переносчики каких-то из жизненных стадий паразитов.</p>
<p>Например, вирус chikungunya из Африки передается при укусах комаров, которые в Бельгии жить не должны. Это тропическая лихорадка. В Бельгии очень мало случаев. Посмотрим помесячную динамику.</p>
<p>Сделаем помесячный индекс, охватывающий все данные в наборе.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">monthindex</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">DateMonday</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="c1"># monthindex = pd.PeriodIndex(start=&#39;2008-01&#39;, end=&#39;2015-12&#39;)</span>
<span class="n">monthindex</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PeriodIndex([&#39;2008-01&#39;, &#39;2008-02&#39;, &#39;2008-03&#39;, &#39;2008-04&#39;, &#39;2008-05&#39;, &#39;2008-06&#39;,
             &#39;2008-07&#39;, &#39;2008-08&#39;, &#39;2008-09&#39;, &#39;2008-10&#39;, &#39;2008-11&#39;, &#39;2008-12&#39;,
             &#39;2009-01&#39;, &#39;2009-02&#39;, &#39;2009-03&#39;, &#39;2009-04&#39;, &#39;2009-05&#39;, &#39;2009-06&#39;,
             &#39;2009-07&#39;, &#39;2009-08&#39;, &#39;2009-09&#39;, &#39;2009-10&#39;, &#39;2009-11&#39;, &#39;2009-12&#39;,
             &#39;2010-01&#39;, &#39;2010-02&#39;, &#39;2010-03&#39;, &#39;2010-04&#39;, &#39;2010-05&#39;, &#39;2010-06&#39;,
             &#39;2010-07&#39;, &#39;2010-08&#39;, &#39;2010-09&#39;, &#39;2010-10&#39;, &#39;2010-11&#39;, &#39;2010-12&#39;,
             &#39;2011-01&#39;, &#39;2011-02&#39;, &#39;2011-03&#39;, &#39;2011-04&#39;, &#39;2011-05&#39;, &#39;2011-06&#39;,
             &#39;2011-07&#39;, &#39;2011-08&#39;, &#39;2011-09&#39;, &#39;2011-10&#39;, &#39;2011-11&#39;, &#39;2011-12&#39;,
             &#39;2012-01&#39;, &#39;2012-02&#39;, &#39;2012-03&#39;, &#39;2012-04&#39;, &#39;2012-05&#39;, &#39;2012-06&#39;,
             &#39;2012-07&#39;, &#39;2012-08&#39;, &#39;2012-09&#39;, &#39;2012-10&#39;, &#39;2012-11&#39;, &#39;2012-12&#39;,
             &#39;2013-01&#39;, &#39;2013-02&#39;, &#39;2013-03&#39;, &#39;2013-04&#39;, &#39;2013-05&#39;, &#39;2013-06&#39;,
             &#39;2013-07&#39;, &#39;2013-08&#39;, &#39;2013-09&#39;, &#39;2013-10&#39;, &#39;2013-11&#39;, &#39;2013-12&#39;,
             &#39;2014-01&#39;, &#39;2014-02&#39;, &#39;2014-03&#39;, &#39;2014-04&#39;, &#39;2014-05&#39;, &#39;2014-06&#39;,
             &#39;2014-07&#39;, &#39;2014-08&#39;, &#39;2014-09&#39;, &#39;2014-10&#39;, &#39;2014-11&#39;, &#39;2014-12&#39;,
             &#39;2015-01&#39;, &#39;2015-02&#39;, &#39;2015-03&#39;, &#39;2015-04&#39;, &#39;2015-05&#39;, &#39;2015-06&#39;,
             &#39;2015-07&#39;, &#39;2015-08&#39;, &#39;2015-09&#39;, &#39;2015-10&#39;, &#39;2015-11&#39;, &#39;2015-12&#39;],
            dtype=&#39;period[M]&#39;, freq=&#39;M&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">D</span><span class="o">.</span><span class="n">Subject</span><span class="o">==</span><span class="s1">&#39;CHIK&#39;</span><span class="p">]</span>
<span class="n">N</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;YM&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">M</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">N</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>YM
2012-02     1
2012-04     4
2012-05     1
2012-07     2
2012-10     1
2012-12     1
2013-07     6
2013-10     1
2014-03     1
2014-04     1
2014-05     3
2014-06     8
2014-07     9
2014-08    16
2014-09    15
2014-10     8
2014-11     6
2014-12     7
2015-01     4
2015-02     5
2015-04     4
2015-05     2
2015-06     7
2015-07     5
2015-08     6
2015-09     2
2015-10     3
2015-11     5
2015-12     1
Name: M, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Теперь сделаем пустую серию с полным индексом и заполним те значения, которые мы посчитали.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">S</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">monthindex</span><span class="p">)</span>
<span class="n">ii</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
<span class="n">S</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">values</span>
<span class="n">S</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_135_0.png" src="_images/i_epistat_135_0.png" />
</div>
</div>
<p>Видно, что случаи болезни были единичными - возможно болезнь привозили туристы из поездок в теплые страны. Но с 2014 количество заболевших этой тропической лихорадкой резко возросло.</p>
<p>И этот график идеально совпадает с <a class="reference external" href="https://en.wikipedia.org/wiki/European_migrant_crisis#Global_refugee_crisis">волной мигрантов, захлестнувшей Европу в 2014-2015 гг</a>.
Среди этих мигрантов и были носители вируса Чикунгунья.</p>
</div>
<div class="section" id="id11">
<h3>Эффекты развития здравоохранения<a class="headerlink" href="#id11" title="Ссылка на этот заголовок">¶</a></h3>
<p>На таком коротком временном отрезке (8 лет) трудно говорить о влиянии развития медицины, хотя безусловно оно есть.</p>
<p>В данном наборе есть один пример резкого снижения заболеваемости, который может быть объяснен успешными противоэпидемиологическими мерами.</p>
<p>Для демонстрации сделаем сводную таблицу динамики по годам, причем нормализуем ее, отняв среднее и разделив на стандартное отклонение.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Species&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">N</span> <span class="o">=</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="n">N</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span> <span class="n">N</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_139_0.png" src="_images/i_epistat_139_0.png" />
</div>
</div>
<p>Сильный «скачок» вниз наблюдался для заболеваний, вызванных Entamoeba histolytica и ВИЧ.
После 2008 года только снижалась заболеваемость сальмонеллезом и гепатитом А.
Как мы знаем значимыми изменениями часто считают те, что выходят за 2 «сигмы». Поскольку те значения, что мы получили после нормализации, как раз в сигмах, то для наглядности мы можем скрыть значения, не достигшие «уровня значимости».</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@interact</span><span class="p">(</span><span class="n">porog</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">_fig</span><span class="p">(</span><span class="n">porog</span><span class="o">=</span><span class="mf">1.96</span><span class="p">):</span>
    <span class="c1">#figure(figsize=(8,6))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">N</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">&lt;</span><span class="n">porog</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_141_0.png" src="_images/i_epistat_141_0.png" />
</div>
</div>
<p>Другой подход оценить отклонения - зафиксировать исходный нулевой уровень на базе начальных данных, например, до 2012 года. Тогда изменения от этого уровня в левой части рисунка будут нивелированы, в правой будут отражать относительные сдвиги в последующие годы.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N_</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">N</span><span class="p">[</span><span class="n">N</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="mi">2013</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">N_</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Все сдвиги&#39;</span><span class="p">)</span>
<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">N_</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">N_</span><span class="o">.</span><span class="n">T</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">);</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Только снижение&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_143_0.png" src="_images/i_epistat_143_0.png" />
<img alt="_images/i_epistat_143_1.png" src="_images/i_epistat_143_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="id12">
<h2>Примеры решения задач<a class="headerlink" href="#id12" title="Ссылка на этот заголовок">¶</a></h2>
<div class="section" id="id13">
<h3>Задача на прогноз по предыдущим значениям<a class="headerlink" href="#id13" title="Ссылка на этот заголовок">¶</a></h3>
<p>По данным epistat постройте прогноз динамики распространения хламидиоза
на неделю, начинающуюся c 2014-09-01, на основании предыдущих данных,
используя метод скользящего среднего с окном в 4 нед.
Ошибка в расчётах составит по сравнению с реальным уровнем?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">D</span><span class="o">.</span><span class="n">Subject</span><span class="o">==</span><span class="s1">&#39;CHLTRA&#39;</span><span class="p">]</span>
<span class="n">N</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;DateMonday&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">DateMonday</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

<span class="n">nreal</span> <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="s1">&#39;2014-09-01&#39;</span><span class="p">]</span>
<span class="n">nreal</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>114
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nnprev</span> <span class="o">=</span> <span class="n">N</span><span class="p">[</span> <span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="s1">&#39;2014-09-01&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;</span> <span class="s1">&#39;2014-07-01&#39;</span><span class="p">)</span> <span class="p">]</span>
<span class="n">nnprev</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DateMonday
2014-07-07    107
2014-07-14     99
2014-07-21     78
2014-07-28    117
2014-08-04    113
2014-08-11     88
2014-08-18    120
2014-08-25    116
Name: DateMonday, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nprognoz</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">nnprev</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="n">nerror</span> <span class="o">=</span> <span class="n">nprognoz</span> <span class="o">-</span> <span class="n">nreal</span>
<span class="n">nprognoz</span><span class="p">,</span> <span class="n">nreal</span><span class="p">,</span> <span class="n">nerror</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(109, 114, -5)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id14">
<h3>Задача на линейную экстраполяцию<a class="headerlink" href="#id14" title="Ссылка на этот заголовок">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Вы моделируете динамику заболеваемости по годам с помощью экстраполяции
линейной регрессионной модели за предыдущие 8 лет.
В каком регионе Бельгии прогнозируется самый сильный относительный рост
заболеваемости респираторно-синцитиальной инфекции в 2016 году (по отношению к 2015 году)?
Выберите один ответ:
a. Hainaut
b. Walloon Brabant
c. West Flanders
d. Antwerp
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ny</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">D</span><span class="o">.</span><span class="n">Subject</span><span class="o">==</span><span class="s1">&#39;V_RSV&#39;</span><span class="p">]</span>
<span class="n">N</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Province&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">N</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Province</th>
      <th>-</th>
      <th>Antwerp</th>
      <th>Brussels</th>
      <th>East Flanders</th>
      <th>Flemish Brabant</th>
      <th>Hainaut</th>
      <th>Liege</th>
      <th>Limburg</th>
      <th>Luxembourg</th>
      <th>Namur</th>
      <th>Walloon Brabant</th>
      <th>West Flanders</th>
    </tr>
    <tr>
      <th>Y</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2008</th>
      <td>116</td>
      <td>1129</td>
      <td>1355</td>
      <td>1066</td>
      <td>591</td>
      <td>453</td>
      <td>169</td>
      <td>433</td>
      <td>173</td>
      <td>343</td>
      <td>143</td>
      <td>1347</td>
    </tr>
    <tr>
      <th>2009</th>
      <td>77</td>
      <td>1268</td>
      <td>1022</td>
      <td>969</td>
      <td>876</td>
      <td>237</td>
      <td>191</td>
      <td>347</td>
      <td>212</td>
      <td>112</td>
      <td>164</td>
      <td>1263</td>
    </tr>
    <tr>
      <th>2010</th>
      <td>114</td>
      <td>1560</td>
      <td>1195</td>
      <td>1032</td>
      <td>722</td>
      <td>436</td>
      <td>430</td>
      <td>472</td>
      <td>367</td>
      <td>193</td>
      <td>105</td>
      <td>970</td>
    </tr>
    <tr>
      <th>2011</th>
      <td>375</td>
      <td>1497</td>
      <td>1354</td>
      <td>1057</td>
      <td>812</td>
      <td>522</td>
      <td>293</td>
      <td>620</td>
      <td>324</td>
      <td>335</td>
      <td>224</td>
      <td>1225</td>
    </tr>
    <tr>
      <th>2012</th>
      <td>160</td>
      <td>1740</td>
      <td>1306</td>
      <td>1466</td>
      <td>987</td>
      <td>621</td>
      <td>766</td>
      <td>691</td>
      <td>383</td>
      <td>462</td>
      <td>257</td>
      <td>1719</td>
    </tr>
    <tr>
      <th>2013</th>
      <td>227</td>
      <td>1313</td>
      <td>1365</td>
      <td>1138</td>
      <td>799</td>
      <td>440</td>
      <td>665</td>
      <td>269</td>
      <td>314</td>
      <td>309</td>
      <td>198</td>
      <td>1261</td>
    </tr>
    <tr>
      <th>2014</th>
      <td>271</td>
      <td>1270</td>
      <td>1179</td>
      <td>1075</td>
      <td>692</td>
      <td>383</td>
      <td>297</td>
      <td>282</td>
      <td>343</td>
      <td>288</td>
      <td>83</td>
      <td>1467</td>
    </tr>
    <tr>
      <th>2015</th>
      <td>113</td>
      <td>1410</td>
      <td>1194</td>
      <td>1393</td>
      <td>905</td>
      <td>543</td>
      <td>777</td>
      <td>655</td>
      <td>291</td>
      <td>168</td>
      <td>42</td>
      <td>1678</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#берем последние 8 лет</span>
<span class="n">N</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="n">ny</span><span class="p">:,:]</span>
</pre></div>
</div>
</div>
</div>
<p>Потренируемся на одной колонке.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
<span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">);</span>

<span class="c1"># добавим тренд</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)),</span> <span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="n">xx</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="n">ny</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">yy</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">intercept</span> <span class="o">+</span> <span class="n">res</span><span class="o">.</span><span class="n">slope</span><span class="o">*</span><span class="n">xx</span>
<span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span> <span class="s1">&#39;-r&#39;</span><span class="p">);</span>

<span class="n">prognoz</span> <span class="o">=</span> <span class="n">yy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">yy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;ro&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LinregressResult(slope=20.047619047619047, intercept=727.8333333333334, rvalue=0.3859663952074691, pvalue=0.34497278078037247, stderr=19.561858008321124)
</pre></div>
</div>
<img alt="_images/i_epistat_154_1.png" src="_images/i_epistat_154_1.png" />
</div>
</div>
<p>Применим ко всем провинциям…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_linreg</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)),</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;slope&#39;</span><span class="p">,</span> <span class="s1">&#39;intercept&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;stderr&#39;</span><span class="p">])</span>

<span class="n">R</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">_linreg</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">R</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>slope</th>
      <th>intercept</th>
      <th>r</th>
      <th>p</th>
      <th>stderr</th>
    </tr>
    <tr>
      <th>Province</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>-</th>
      <td>12.773810</td>
      <td>136.916667</td>
      <td>0.307570</td>
      <td>0.458644</td>
      <td>16.133216</td>
    </tr>
    <tr>
      <th>Antwerp</th>
      <td>17.607143</td>
      <td>1336.750000</td>
      <td>0.221236</td>
      <td>0.598520</td>
      <td>31.685545</td>
    </tr>
    <tr>
      <th>Brussels</th>
      <td>1.428571</td>
      <td>1241.250000</td>
      <td>0.029092</td>
      <td>0.945483</td>
      <td>20.038632</td>
    </tr>
    <tr>
      <th>East Flanders</th>
      <td>42.214286</td>
      <td>1001.750000</td>
      <td>0.574132</td>
      <td>0.136671</td>
      <td>24.577063</td>
    </tr>
    <tr>
      <th>Flemish Brabant</th>
      <td>20.047619</td>
      <td>727.833333</td>
      <td>0.385966</td>
      <td>0.344973</td>
      <td>19.561858</td>
    </tr>
    <tr>
      <th>Hainaut</th>
      <td>17.511905</td>
      <td>393.083333</td>
      <td>0.371981</td>
      <td>0.364204</td>
      <td>17.840104</td>
    </tr>
    <tr>
      <th>Liege</th>
      <td>71.000000</td>
      <td>200.000000</td>
      <td>0.687845</td>
      <td>0.059351</td>
      <td>30.587501</td>
    </tr>
    <tr>
      <th>Limburg</th>
      <td>8.226190</td>
      <td>442.333333</td>
      <td>0.119869</td>
      <td>0.777389</td>
      <td>27.814631</td>
    </tr>
    <tr>
      <th>Luxembourg</th>
      <td>16.440476</td>
      <td>243.333333</td>
      <td>0.546954</td>
      <td>0.160637</td>
      <td>10.273005</td>
    </tr>
    <tr>
      <th>Namur</th>
      <td>1.547619</td>
      <td>270.833333</td>
      <td>0.033573</td>
      <td>0.937098</td>
      <td>18.808444</td>
    </tr>
    <tr>
      <th>Walloon Brabant</th>
      <td>-9.523810</td>
      <td>185.333333</td>
      <td>-0.318219</td>
      <td>0.442396</td>
      <td>11.583115</td>
    </tr>
    <tr>
      <th>West Flanders</th>
      <td>56.000000</td>
      <td>1170.250000</td>
      <td>0.552907</td>
      <td>0.155206</td>
      <td>34.453413</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prognoz</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">intercept</span> <span class="o">+</span> <span class="n">R</span><span class="o">.</span><span class="n">slope</span><span class="o">*</span><span class="p">(</span><span class="n">ny</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">prognoz</span> <span class="o">=</span> <span class="n">prognoz</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">prognoz</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Province
-                   239
Antwerp            1477
Brussels           1252
East Flanders      1339
Flemish Brabant     888
Hainaut             533
Liege               768
Limburg             508
Luxembourg          374
Namur               283
Walloon Brabant     109
West Flanders      1618
dtype: int32
</pre></div>
</div>
</div>
</div>
<p>Прирост относительно предыдущего значения…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">last</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
<span class="n">rost</span> <span class="o">=</span> <span class="p">(</span><span class="n">prognoz</span> <span class="o">-</span> <span class="n">last</span><span class="p">)</span> <span class="o">/</span> <span class="n">last</span>
<span class="n">rost</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Province
-                  1.115044
Antwerp            0.047518
Brussels           0.048576
East Flanders     -0.038765
Flemish Brabant   -0.018785
Hainaut           -0.018416
Liege             -0.011583
Limburg           -0.224427
Luxembourg         0.285223
Namur              0.684524
Walloon Brabant    1.595238
West Flanders     -0.035757
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rost</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Walloon Brabant&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pname</span> <span class="o">=</span> <span class="s1">&#39;Walloon Brabant&#39;</span>
<span class="n">plot</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">N</span><span class="p">[</span><span class="n">pname</span><span class="p">],</span> <span class="s1">&#39;bo&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="n">prognoz</span><span class="p">[</span><span class="n">pname</span><span class="p">],</span> <span class="s1">&#39;ro&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_161_0.png" src="_images/i_epistat_161_0.png" />
</div>
</div>
<p>В 2015 было всего 42 случая, но экстраполяция снижающегося тренда дала на 2016 год значение 109, что больше примерно в полтора раза.</p>
</div>
<div class="section" id="id15">
<h3>Задача на лаг в неделях<a class="headerlink" href="#id15" title="Ссылка на этот заголовок">¶</a></h3>
<p>Каков лаг в неделях между сезонными колебаниями заболеваемости шигеллёза и аденовирусной инфекции?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">D</span><span class="o">.</span><span class="n">Subject</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;SHIG&#39;</span><span class="p">,</span><span class="s1">&#39;V_ADV&#39;</span><span class="p">])]</span>
<span class="n">N</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="s1">&#39;Subject&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">N</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">detrend</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">N</span> <span class="o">=</span> <span class="n">N</span> <span class="o">/</span> <span class="n">N</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">N</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_164_0.png" src="_images/i_epistat_164_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    
<span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;full&#39;</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">:]</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    
<span class="n">plot</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_165_0.png" src="_images/i_epistat_165_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">365</span><span class="o">/</span><span class="mi">7</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>52.142857142857146
</pre></div>
</div>
</div>
</div>
<p>Более подробно кросс-корреляционная функция на год (~52 недели).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Лаг, нед&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Корреляция&#39;</span><span class="p">)</span>
<span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">52</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_168_0.png" src="_images/i_epistat_168_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>30
</pre></div>
</div>
</div>
</div>
<p>Тридцать недель - это примерно 6 месяцев, т.е. простудное заболевание и кишечное отравление имеют пики зимой и летом.</p>
</div>
<div class="section" id="id16">
<h3>Задача на выявление корреляций<a class="headerlink" href="#id16" title="Ссылка на этот заголовок">¶</a></h3>
<p>С каким заболеванием максимально коррелирует число случаев хламидиоза в Антверпене за весь период, отраженный в наборе данных
за период с 1990 по 2014</p>
<p>Один из хламидиозов - хламидиоз попугайчиков очень редкий. Наверно имеется в виду более распространенное ЗППП.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">D</span><span class="p">[(</span><span class="n">D</span><span class="o">.</span><span class="n">Subject</span><span class="o">==</span><span class="s1">&#39;CHLTRA&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">Province</span> <span class="o">==</span> <span class="s1">&#39;Antwerp&#39;</span><span class="p">)]</span>
<span class="n">X</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;DateMonday&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">Subject</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_173_0.png" src="_images/i_epistat_173_0.png" />
</div>
</div>
<p>Мы видим рост заболеваемости. С какими наборами данных нужно посчитать корреляцию? Нужно получить динамику для всех инфекций в этом регионе.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">D</span><span class="p">[(</span><span class="n">D</span><span class="o">.</span><span class="n">Province</span> <span class="o">==</span> <span class="s1">&#39;Antwerp&#39;</span><span class="p">)]</span>


<span class="n">Y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="s1">&#39;Province&#39;</span><span class="p">,</span> <span class="s1">&#39;DateMonday&#39;</span><span class="p">,</span> <span class="s1">&#39;Subject&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Y</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_175_0.png" src="_images/i_epistat_175_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">C</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="c1"># удаляем пересечение с одноименной колонкой, потому что корреляция с самим собой всегда 1.0.</span>
<span class="n">_C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;CHLTRA&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;CHLTRA&#39;</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">_C</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/i_epistat_176_0.png" src="_images/i_epistat_176_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_C</span><span class="p">[</span><span class="s1">&#39;CHLTRA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;NEIGON&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">species</span><span class="p">[</span><span class="s1">&#39;NEIGON&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Neisseria gonorrhoeae&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_C</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;NEIGON&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Subject
CHLTRA    0.529694
Name: NEIGON, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Корреляция 53% с динамикой другого ЗППП - гонореей.</p>
<div class="admonition seealso">
<p class="admonition-title">См.также</p>
<ul class="simple">
<li><p><a class="reference external" href="https://surveillance.r-forge.r-project.org/">Статистические методы моделирования и мониторинга временных рядов подсчетов, пропорций и категориальных данных</a>
surveillance - пакет для пространственно-временного моделирования и мониторинга эпидемических явлений</p></li>
</ul>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="i_age_logistic.html" title="previous page">Скрининговая диагностика</a>
    <a class='right-next' id="next-link" href="w_epistat.html" title="next page">☑ Динамика заболеваний</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Дмитрий Н. Щербина<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>
